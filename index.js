// content of index.js
const http = require('http')
const port = 3000
var jsonexport = require('jsonexport');

const requestHandler = (request, response) => {

	var jsonFile = "/Users/jamesra@kainos.com/Desktop/Projects/jsonToCsv/data/test.csv";


	var contacts = {"id":1,"referenceNumber":"CVEDP.GB.2019.1000001","version":1,"lastUpdated":"2019-02-25T16:36:55.09Z","lastUpdatedBy":{"displayName":"EU-Imports-InspectorTestUser1","userId":"s_RcwY29955gH7DEKLupAA-FPA4U8xbltyAGMuJ3uto"},"type":"CVEDP","status":"SUBMITTED","partOne":{"personResponsible":{"name":"JamesFranco","companyId":"1","companyName":"Acme Importers Limited","address":["23 High Street, Newcastle, ABC123"],"country":"GB","city":"Newcastle","tracesID":1,"contactId":"4RJYJCUOesUxS12tnO4lRUm86Xntz-1gB4nkjdrXN5A"},"consignor":{"type":"exporter","status":"approved","companyName":"MARCH SEGARRA,SA","individualName":"MARCH SEGARRA,SA","address":{"addressLine1":"CTRA LA COMELLA,45","city":"Andorra","postalZipCode":"AD500","countryISOCode":"AD"}},"consignee":{"type":"consignee","status":"approved","companyName":"Acme Importers Limited","individualName":"Acme Importers Limited","address":{"addressLine1":"23 High Street, Newcastle, ABC123","city":"Newcastle","postalZipCode":"CB3","countryISOCode":"GB"}},"importer":{"type":"importer","status":"approved","companyName":"JONES AS &amp; JT","individualName":"JONES AS &amp; JT","address":{"addressLine1":"66 RICKAMORE ROAD UPPER TEMPLEPATRICK BALLYCLARE","city":"BALLYCLARE","postalZipCode":"BT39","countryISOCode":"GB"}},"placeOfDestination":{"type":"destination","status":"approved","companyName":"Five Sisters Zoo Park","address":{"addressLine1":"Gavieside","city":"Gavieside","postalZipCode":"EH55","countryISOCode":"GB"}},"commodity":{"commodityID":"02042210"},"commodities":{"totalGrossWeight":8678,"totalNetWeight":101,"numberOfPackages":5,"temperature":"Chilled","numberOfAnimals":0,"commodityComplement":[{"commodityID":"02042210","commodityDescription":"Short forequarters","complementID":131906,"speciesID":"8944427","speciesName":"Ovis aries","speciesTypeName":"Domestic","speciesType":"131906","speciesClass":"131906","speciesFamily":"131906","speciesNomination":"Ovis aries"},{"commodityID":"02032110","commodityDescription":"Of domestic swine","complementID":131711,"speciesID":"8943591","speciesName":"Sus scrofa domesticus","speciesType":"131711","speciesClass":"131711","speciesFamily":"131711","speciesNomination":"Sus scrofa domesticus"}],"complementParameterSet":[{"complementID":131906,"speciesID":"8944427","keyDataPair":[{"key":"netweight","data":"41"},{"key":"number_package","data":"2"},{"key":"type_package","data":"Box"}]},{"complementID":131711,"speciesID":"8943591","keyDataPair":[{"key":"netweight","data":"60"},{"key":"number_package","data":"3"},{"key":"type_package","data":"Crate"}]}],"includeNonAblactedAnimals":false,"countryOfOrigin":"FJ","consignedCountry":"IS"},"purpose":{"conformsToEU":true,"thirdCountryTranshipment":"NU","exitBIP":"Belfast","thirdCountry":"TH","transitThirdCountries":["GB"],"finalBIP":"GBPHD1","purposeGroup":"For Transhipment to"},"pointOfEntry":"GBFXT1","arrivalDate":"2019-04-24","arrivalTime":"11:40:00","transporter":{"type":"private transporter","status":"approved","companyName":"Chris+Nichol","individualName":"Chris+Nichol","approvalNumber":"GB00113999","address":{"addressLine1":"The Grove Cartwright street Cleckheaton bd19 5lx","city":"Cleckheaton","postalZipCode":"BD19","countryISOCode":"GB"}},"transporterDetailsRequired":true,"meansOfTransport":{"type":"Ship","document":"CVEDP_TRANSPORT_DOC.159447","id":"CVEDPTRANSPORT_ID.582393"},"meansOfTransportFromEntryPoint":{"type":"Aeroplane","document":"CVEDP_VET_DOC.023","id":"CVEDP_VET_ID.700"},"departureDate":"2019-07-16","departureTime":"06:28:00","veterinaryInformation":{"veterinaryDocument":"CVEDP_VET.228773","veterinaryDocumentIssueDate":"2018-03-15","accompanyingDocumentNumbers":["n/a"]},"importerLocalReferenceNumber":"CVEDP.550447","route":{"transferPoints":[{"plannedControlOrTransferPoint":{"name":"n/a","companyName":"","address":["","","",""],"county":"","postCode":"22HA0","country":"GB","city":"Wembley","tracesID":1},"date":"2018-02-02","time":"10:10"}]},"sealsContainers":[{"sealNumber":"3191","containerNumber":"5089"}],"submissionDate":"2018-06-05T10:59:55.689Z"},"decisionDate":"2018-03-19T10:42:13.885Z","partTwo":{"decision":{"consignmentAcceptable":false,"notAcceptableAction":"destruction","notAcceptableDestructionReason":"ednjnk","notAcceptableActionByDate":"2019-12-14","notAcceptableReasons":["AbsenceInvalidCertificate"],"decision":"Non Acceptable"},"consignmentCheck":{"documentCheckResult":"Satisfactory","identityCheckType":"Full Identity Check","identityCheckResult":"Satisfactory","physicalCheckResult":"Satisfactory"},"impactOfTransportOnAnimals":{"numberOfDeadAnimals":0,"numberOfUnfitAnimals":0},"laboratoryTestsRequired":true,"laboratoryTests":{"testDate":"2019-02-25T16:36:02.583","testReason":"Random","singleLaboratoryTests":[{"commodityCode":"02042210","speciesID":8944427,"speciesName":"Ovis aries","tracesID":1,"testName":"Thiouracil","laboratoryTestResult":{"conclusion":"Pending"}}]},"controlAuthority":{"officialVeterinarian":{"firstName":"EU-Imports-InspectorTestUser1","lastName":"EU-Imports-InspectorTestUser1","email":"EU-Imports-InspectorTestUser1@defrasandpit.onmicrosoft.com","signed":"2019-02-25T16:37:20.331"},"iuuOption":"IUUOK"},"consignmentValidation":[{"field":"uk/gov/defra/tracesx/notification/representation/partone/veterinaryinformation/establishmentsoforigin","message":"Approved establishment"}]}}

	jsonexport(contacts,function(err, csv){
	    if(err) return console.log(err);
	    response.end(csv);
	});
}

const server = http.createServer(requestHandler)

server.listen(port, (err) => {
  if (err) {
    return console.log('something bad happened', err)
  }

  console.log(`server is listening on ${port}`)
})